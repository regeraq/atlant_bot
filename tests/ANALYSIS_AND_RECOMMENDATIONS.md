# üìä –ê–ù–ê–õ–ò–ó –¢–ï–°–¢–û–í–û–ì–û –ü–û–ö–†–´–¢–ò–Ø –ò –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò

## üîç –ê–ù–ê–õ–ò–ó –°–£–©–ï–°–¢–í–£–Æ–©–ò–• –¢–ï–°–¢–û–í

**–°—Ç–∞—Ç—É—Å:** ‚ùå **–¢–µ—Å—Ç—ã –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç**

–ü—Ä–æ–µ–∫—Ç –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–µ—Å—Ç–æ–≤. –°–æ–∑–¥–∞–Ω –ø–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä —Ç–µ—Å—Ç–æ–≤ –¥–ª—è –æ—Å–Ω–æ–≤–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤.

---

## ‚úÖ –°–û–ó–î–ê–ù–ù–´–ï –¢–ï–°–¢–´

### 1. Unit —Ç–µ—Å—Ç—ã

#### ‚úÖ `tests/unit/test_cache.py`
**–ü–æ–∫—Ä—ã—Ç–∏–µ:** –ú–æ–¥—É–ª—å `bot/utils/cache.py`

**–ü–æ–∫—Ä—ã—Ç—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:**
- ‚úÖ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫—ç—à–∞ (default –∏ custom TTL)
- ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –ø–æ–ª—É—á–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏–π
- ‚úÖ –ü–æ–ª—É—á–µ–Ω–∏–µ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∫–ª—é—á–µ–π
- ‚úÖ –ò—Å—Ç–µ—á–µ–Ω–∏–µ TTL (expired keys)
- ‚úÖ –£–¥–∞–ª–µ–Ω–∏–µ –∫–ª—é—á–µ–π (—Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∏ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö)
- ‚úÖ –û—á–∏—Å—Ç–∫–∞ –≤—Å–µ–≥–æ –∫—ç—à–∞
- ‚úÖ `get_or_set` (cache hit –∏ cache miss)
- ‚úÖ –ü–µ—Ä–µ–∑–∞–ø–∏—Å—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∫–ª—é—á–µ–π
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ None –∑–Ω–∞—á–µ–Ω–∏–π
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–ª–æ–∂–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤
- ‚úÖ –ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ã–π –¥–æ—Å—Ç—É–ø

**Edge cases:**
- ‚úÖ –ò—Å—Ç–µ—á–µ–Ω–∏–µ TTL
- ‚úÖ –ü—É—Å—Ç—ã–µ –∫–ª—é—á–∏
- ‚úÖ None –∑–Ω–∞—á–µ–Ω–∏—è
- ‚úÖ –ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–∞—è –∑–∞–ø–∏—Å—å

**–ù–µ –ø–æ–∫—Ä—ã—Ç–æ:**
- ‚ö†Ô∏è –†–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –∏—Å—Ç–µ—á–µ–Ω–∏—è TTL (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `time.sleep`, –º–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å —á–µ—Ä–µ–∑ –º–æ–∫–∏)

---

#### ‚úÖ `tests/unit/test_helpers.py`
**–ü–æ–∫—Ä—ã—Ç–∏–µ:** –ú–æ–¥—É–ª—å `bot/utils/helpers.py`

**–ü–æ–∫—Ä—ã—Ç—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:**
- ‚úÖ –£—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç –Ω–∞ callback
- ‚úÖ –û—Ç–≤–µ—Ç —Å —Ç–µ–∫—Å—Ç–æ–º
- ‚úÖ –û—Ç–≤–µ—Ç —Å alert
- ‚úÖ –ö–æ–º–±–∏–Ω–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–∞ –∏ alert
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏ "query is too old"
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏ timeout
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏ "query id is invalid"
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥—Ä—É–≥–∏—Ö TelegramBadRequest –æ—à–∏–±–æ–∫
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã—Ö –∏—Å–∫–ª—é—á–µ–Ω–∏–π
- ‚úÖ –†–µ–≥–∏—Å—Ç—Ä–æ–Ω–µ–∑–∞–≤–∏—Å–∏–º–æ–µ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫

**Edge cases:**
- ‚úÖ –í—Å–µ —Ç–∏–ø—ã –æ—à–∏–±–æ–∫ Telegram API
- ‚úÖ –ù–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è

**–ù–µ –ø–æ–∫—Ä—ã—Ç–æ:**
- ‚úÖ –í—Å–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –ø–æ–∫—Ä—ã—Ç—ã

---

#### ‚úÖ `tests/unit/test_config.py`
**–ü–æ–∫—Ä—ã—Ç–∏–µ:** –ú–æ–¥—É–ª—å `bot/config.py`

**–ü–æ–∫—Ä—ã—Ç—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:**

**–í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–∞:**
- ‚úÖ –í–∞–ª–∏–¥–Ω—ã–π —Ç–æ–∫–µ–Ω
- ‚úÖ None —Ç–æ–∫–µ–Ω
- ‚úÖ –ü—É—Å—Ç–æ–π —Ç–æ–∫–µ–Ω
- ‚úÖ –¢–æ–∫–µ–Ω —Ç–æ–ª—å–∫–æ —Å –ø—Ä–æ–±–µ–ª–∞–º–∏
- ‚úÖ –°–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–π —Ç–æ–∫–µ–Ω
- ‚úÖ –¢–æ–∫–µ–Ω –±–µ–∑ –¥–≤–æ–µ—Ç–æ—á–∏—è (–ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ)
- ‚úÖ –û–±—Ä–µ–∑–∫–∞ –ø—Ä–æ–±–µ–ª–æ–≤

**–ü–∞—Ä—Å–∏–Ω–≥ ID –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤:**
- ‚úÖ –û–¥–∏–Ω ID
- ‚úÖ –ù–µ—Å–∫–æ–ª—å–∫–æ ID
- ‚úÖ –ü—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞
- ‚úÖ None –∑–Ω–∞—á–µ–Ω–∏–µ
- ‚úÖ ID —Å –ø—Ä–æ–±–µ–ª–∞–º–∏
- ‚úÖ –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ ID (–∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç—Å—è)
- ‚úÖ –û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ ID (–∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç—Å—è)
- ‚úÖ –ù—É–ª–µ–≤–æ–π ID (–∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è)
- ‚úÖ –ü—É—Å—Ç—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è (–∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç—Å—è)
- ‚úÖ –í—Å–µ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ ID

**–ü–∞—Ä—Å–∏–Ω–≥ ID –∫–æ–Ω—Ç–∞–∫—Ç–∞:**
- ‚úÖ –í–∞–ª–∏–¥–Ω—ã–π ID
- ‚úÖ None –∑–Ω–∞—á–µ–Ω–∏–µ
- ‚úÖ –ü—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞
- ‚úÖ ID —Å –ø—Ä–æ–±–µ–ª–∞–º–∏
- ‚úÖ –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç
- ‚úÖ –û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π ID
- ‚úÖ –ù—É–ª–µ–≤–æ–π ID

**–í–∞–ª–∏–¥–∞—Ü–∏—è –ø—É—Ç–∏ –ë–î:**
- ‚úÖ –í–∞–ª–∏–¥–Ω—ã–π –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π –ø—É—Ç—å
- ‚úÖ –ü—É—Ç—å —Å –ø—Ä–æ–±–µ–ª–∞–º–∏
- ‚úÖ –ü—É—Ç—å —Å —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–µ–π (–ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ)
- ‚úÖ –ê–±—Å–æ–ª—é—Ç–Ω—ã–π –ø—É—Ç—å (–ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ)
- ‚úÖ –ü—É—Ç—å —Å–æ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–º–∏ —Å–∏–º–≤–æ–ª–∞–º–∏

**Edge cases:**
- ‚úÖ –í—Å–µ –≥—Ä–∞–Ω–∏—á–Ω—ã–µ —Å–ª—É—á–∞–∏ –ø–æ–∫—Ä—ã—Ç—ã

**–ù–µ –ø–æ–∫—Ä—ã—Ç–æ:**
- ‚ö†Ô∏è –ó–∞–≥—Ä—É–∑–∫–∞ .env —Ñ–∞–π–ª–∞ (—Ç—Ä–µ–±—É–µ—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤)
- ‚ö†Ô∏è –ü–æ–ª–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (—Ç—Ä–µ–±—É–µ—Ç –º–æ–∫–∏—Ä–æ–≤–∞–Ω–∏—è os.getenv)

---

#### ‚úÖ `tests/unit/test_car_service.py`
**–ü–æ–∫—Ä—ã—Ç–∏–µ:** –ú–æ–¥—É–ª—å `bot/services/car_service.py`

**–ü–æ–∫—Ä—ã—Ç—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:**
- ‚úÖ –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π
- ‚úÖ –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π
- ‚úÖ –ü–æ–ª—É—á–µ–Ω–∏–µ –∞–≤—Ç–æ–º–æ–±–∏–ª—è –ø–æ ID
- ‚úÖ –ü–æ–ª—É—á–µ–Ω–∏–µ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∞–≤—Ç–æ–º–æ–±–∏–ª—è
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –≤–∞–ª–∏–¥–Ω–æ–≥–æ –∞–≤—Ç–æ–º–æ–±–∏–ª—è
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞–∑–≤–∞–Ω–∏—è (—Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–æ–µ)
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞–∑–≤–∞–Ω–∏—è (—Ç–æ–ª—å–∫–æ –ø—Ä–æ–±–µ–ª—ã)
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è —Ü–µ–Ω—ã (–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–∞—è)
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è —Ü–µ–Ω—ã (–Ω–æ–ª—å)
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è —Ü–µ–Ω—ã (—Å–ª–∏—à–∫–æ–º –≤—ã—Å–æ–∫–∞—è)
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∞–≤—Ç–æ–º–æ–±–∏–ª—è
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- ‚úÖ –£–¥–∞–ª–µ–Ω–∏–µ –∞–≤—Ç–æ–º–æ–±–∏–ª—è
- ‚úÖ –£–¥–∞–ª–µ–Ω–∏–µ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∞–≤—Ç–æ–º–æ–±–∏–ª—è

**Edge cases:**
- ‚úÖ –í—Å–µ –≥—Ä–∞–Ω–∏—á–Ω—ã–µ —Å–ª—É—á–∞–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- ‚úÖ –ì—Ä–∞–Ω–∏—á–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è —Ü–µ–Ω (0, –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ, —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–∏–µ)
- ‚úÖ –ì—Ä–∞–Ω–∏—á–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –Ω–∞–∑–≤–∞–Ω–∏–π (–ø—É—Å—Ç—ã–µ, –∫–æ—Ä–æ—Ç–∫–∏–µ)

**–ù–µ –ø–æ–∫—Ä—ã—Ç–æ:**
- ‚ö†Ô∏è –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è (–º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã —Å –∏—Å–∫–ª—é—á–µ–Ω–∏—è–º–∏)

---

### 2. Integration —Ç–µ—Å—Ç—ã

#### ‚úÖ `tests/integration/test_database.py`
**–ü–æ–∫—Ä—ã—Ç–∏–µ:** –ú–æ–¥—É–ª—å `bot/database/db_pool.py`

**–ü–æ–∫—Ä—ã—Ç—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:**
- ‚úÖ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—É–ª–∞
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü
- ‚úÖ –í—Å—Ç–∞–≤–∫–∞ –∏ –≤—ã–±–æ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (–æ—Ç–∫–∞—Ç)
- ‚úÖ –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
- ‚úÖ –ó–∞–∫—Ä—ã—Ç–∏–µ –ø—É–ª–∞

**Edge cases:**
- ‚úÖ –†–∞–±–æ—Ç–∞ —Å —Ä–µ–∞–ª—å–Ω–æ–π –ë–î
- ‚úÖ –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

**–ù–µ –ø–æ–∫—Ä—ã—Ç–æ:**
- ‚ö†Ô∏è –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- ‚ö†Ô∏è –¢–µ—Å—Ç—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- ‚ö†Ô∏è –¢–µ—Å—Ç—ã –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞

---

#### ‚úÖ `tests/integration/test_car_repository.py`
**–ü–æ–∫—Ä—ã—Ç–∏–µ:** –ú–æ–¥—É–ª—å `bot/database/repositories/car_repository.py`

**–ü–æ–∫—Ä—ã—Ç—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:**
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –∞–≤—Ç–æ–º–æ–±–∏–ª—è
- ‚úÖ –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ ID
- ‚úÖ –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π
- ‚úÖ –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∞–≤—Ç–æ–º–æ–±–∏–ª—è
- ‚úÖ –£–¥–∞–ª–µ–Ω–∏–µ –∞–≤—Ç–æ–º–æ–±–∏–ª—è
- ‚úÖ –†–∞–±–æ—Ç–∞ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
- ‚úÖ –ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –∫—ç—à–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏

**Edge cases:**
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Ä–µ–∞–ª—å–Ω–æ–π –ë–î
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –∫—ç—à–µ–º

**–ù–µ –ø–æ–∫—Ä—ã—Ç–æ:**
- ‚ö†Ô∏è –£–¥–∞–ª–µ–Ω–∏–µ –∞–≤—Ç–æ–º–æ–±–∏–ª—è —Å –∞–∫—Ç–∏–≤–Ω—ã–º–∏ –∞—Ä–µ–Ω–¥–∞–º–∏
- ‚ö†Ô∏è –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ë–î
- ‚ö†Ô∏è –¢–µ—Å—Ç—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ø—Ä–∏ –±–æ–ª—å—à–æ–º –æ–±—ä–µ–º–µ –¥–∞–Ω–Ω—ã—Ö

---

## üìã –ù–ï–ü–û–ö–†–´–¢–´–ï –ö–û–ú–ü–û–ù–ï–ù–¢–´ –ò –°–¶–ï–ù–ê–†–ò–ò

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –±–µ–∑ —Ç–µ—Å—Ç–æ–≤:

#### 1. Handlers (bot/handlers/)
- ‚ùå **user_handlers.py** - –Ω–µ—Ç —Ç–µ—Å—Ç–æ–≤
- ‚ùå **admin_handlers.py** - –Ω–µ—Ç —Ç–µ—Å—Ç–æ–≤ (2541 —Å—Ç—Ä–æ–∫–∞!)
- ‚ùå **broadcast_handlers.py** - –Ω–µ—Ç —Ç–µ—Å—Ç–æ–≤
- ‚ùå **contact_handlers.py** - –Ω–µ—Ç —Ç–µ—Å—Ç–æ–≤

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ —Ç–µ—Å—Ç—ã:**
- –¢–µ—Å—Ç—ã –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –∫–æ–º–∞–Ω–¥ (/start, /help)
- –¢–µ—Å—Ç—ã callback handlers
- –¢–µ—Å—Ç—ã FSM —Å–æ—Å—Ç–æ—è–Ω–∏–π
- –¢–µ—Å—Ç—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –¢–µ—Å—Ç—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫

#### 2. Database (bot/database/)
- ‚ö†Ô∏è **database.py** - —á–∞—Å—Ç–∏—á–Ω–æ –ø–æ–∫—Ä—ã—Ç —á–µ—Ä–µ–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
- ‚ùå **rental_repository.py** - –Ω–µ—Ç —Ç–µ—Å—Ç–æ–≤
- ‚ùå **user_repository.py** - –Ω–µ—Ç —Ç–µ—Å—Ç–æ–≤

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ —Ç–µ—Å—Ç—ã:**
- –¢–µ—Å—Ç—ã –≤—Å–µ—Ö CRUD –æ–ø–µ—Ä–∞—Ü–∏–π
- –¢–µ—Å—Ç—ã —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- –¢–µ—Å—Ç—ã –º–∏–≥—Ä–∞—Ü–∏–π
- –¢–µ—Å—Ç—ã –∏–Ω–¥–µ–∫—Å–æ–≤

#### 3. Services (bot/services/)
- ‚ö†Ô∏è **car_service.py** - –ø–æ–∫—Ä—ã—Ç unit —Ç–µ—Å—Ç–∞–º–∏
- ‚ùå –î—Ä—É–≥–∏–µ —Å–µ—Ä–≤–∏—Å—ã –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç (rental_service, user_service –∏ —Ç.–¥.)

#### 4. Utils (bot/utils/)
- ‚úÖ **cache.py** - –ø–æ–∫—Ä—ã—Ç —Ç–µ—Å—Ç–∞–º–∏
- ‚úÖ **helpers.py** - –ø–æ–∫—Ä—ã—Ç —Ç–µ—Å—Ç–∞–º–∏
- ‚ùå **scheduler.py** - –Ω–µ—Ç —Ç–µ—Å—Ç–æ–≤
- ‚ùå **notifications.py** - –Ω–µ—Ç —Ç–µ—Å—Ç–æ–≤

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è scheduler.py:**
- –¢–µ—Å—Ç—ã –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π
- –¢–µ—Å—Ç—ã —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ç–∏–ø–æ–≤ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π (daily, weekly, monthly)
- –¢–µ—Å—Ç—ã —Ä–∞—Å—á–µ—Ç–∞ –¥–∞—Ç –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π
- –¢–µ—Å—Ç—ã –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è notifications.py:**
- –¢–µ—Å—Ç—ã —Ä–∞—Å—Å—ã–ª–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
- –¢–µ—Å—Ç—ã —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ç–∏–ø–æ–≤ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
- –¢–µ—Å—Ç—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ –ø—Ä–∏ —Ä–∞—Å—Å—ã–ª–∫–µ
- –¢–µ—Å—Ç—ã —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Ä–∞—Å—Å—ã–ª–∫–∏

#### 5. Config (bot/config.py)
- ‚ö†Ô∏è –ß–∞—Å—Ç–∏—á–Ω–æ –ø–æ–∫—Ä—ã—Ç unit —Ç–µ—Å—Ç–∞–º–∏
- ‚ùå –ü–æ–ª–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ - –Ω–µ—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤

#### 6. Keyboards (bot/keyboards/)
- ‚ùå –ù–µ—Ç —Ç–µ—Å—Ç–æ–≤ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–ª–∞–≤–∏–∞—Ç—É—Ä
- ‚ùå –ù–µ—Ç —Ç–µ—Å—Ç–æ–≤ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ callback_data

---

## üéØ –†–ï–ö–û–ú–ï–ù–î–£–ï–ú–´–ï –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –¢–ï–°–¢–´

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

#### 1. –¢–µ—Å—Ç—ã –¥–ª—è handlers
```python
# tests/unit/test_user_handlers.py
- –¢–µ—Å—Ç handle_cars_button
- –¢–µ—Å—Ç handle_car_details_callback
- –¢–µ—Å—Ç handle_book_car_callback
- –¢–µ—Å—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫
- –¢–µ—Å—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
```

#### 2. –¢–µ—Å—Ç—ã –¥–ª—è scheduler
```python
# tests/unit/test_scheduler.py
- –¢–µ—Å—Ç —Ä–∞—Å—á–µ—Ç–∞ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π
- –¢–µ—Å—Ç —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ç–∏–ø–æ–≤ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π
- –¢–µ—Å—Ç –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π
- –¢–µ—Å—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫
```

#### 3. –¢–µ—Å—Ç—ã –¥–ª—è notifications
```python
# tests/unit/test_notifications.py
- –¢–µ—Å—Ç —Ä–∞—Å—Å—ã–ª–∫–∏ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
- –¢–µ—Å—Ç —Ä–∞—Å—Å—ã–ª–∫–∏ –º–µ–¥–∏–∞
- –¢–µ—Å—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –¢–µ—Å—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Ä–∞—Å—Å—ã–ª–∫–∏
```

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2: –í–∞–∂–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

#### 4. –¢–µ—Å—Ç—ã –¥–ª—è rental_repository
```python
# tests/unit/test_rental_repository.py
- –¢–µ—Å—Ç —Å–æ–∑–¥–∞–Ω–∏—è –∞—Ä–µ–Ω–¥—ã
- –¢–µ—Å—Ç –ø–æ–ª—É—á–µ–Ω–∏—è –∞–∫—Ç–∏–≤–Ω—ã—Ö –∞—Ä–µ–Ω–¥
- –¢–µ—Å—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∞—Ä–µ–Ω–¥—ã
- –¢–µ—Å—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π
```

#### 5. –¢–µ—Å—Ç—ã –¥–ª—è user_repository
```python
# tests/unit/test_user_repository.py
- –¢–µ—Å—Ç —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –¢–µ—Å—Ç –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –¢–µ—Å—Ç –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ Telegram ID
```

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã

#### 6. E2E —Ç–µ—Å—Ç—ã
```python
# tests/e2e/test_bot_flow.py
- –¢–µ—Å—Ç –ø–æ–ª–Ω–æ–≥–æ flow –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –¢–µ—Å—Ç –ø–æ–ª–Ω–æ–≥–æ flow –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
- –¢–µ—Å—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ –Ω–∞ —É—Ä–æ–≤–Ω–µ –±–æ—Ç–∞
```

#### 7. –¢–µ—Å—Ç—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
```python
# tests/performance/test_cache_performance.py
- –¢–µ—Å—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∫—ç—à–∞
- –¢–µ—Å—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ë–î
- –¢–µ—Å—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Ä–∞—Å—Å—ã–ª–∫–∏
```

---

## üîß –†–ï–§–ê–ö–¢–û–†–ò–ù–ì –°–£–©–ï–°–¢–í–£–Æ–©–ò–• –¢–ï–°–¢–û–í

### –£–ª—É—á—à–µ–Ω–∏—è –¥–ª—è —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏:

1. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ñ–∏–∫—Å—Ç—É—Ä pytest** - ‚úÖ –£–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
2. **–ü–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤** - –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –¥–ª—è –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è —Ç–µ—Å—Ç–æ–≤
3. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ pytest.mark.parametrize** - –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

### –£–ª—É—á—à–µ–Ω–∏—è –¥–ª—è —Å–∫–æ—Ä–æ—Å—Ç–∏:

1. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –º–æ–∫–æ–≤ –≤–º–µ—Å—Ç–æ —Ä–µ–∞–ª—å–Ω–æ–π –ë–î** - ‚úÖ –ß–∞—Å—Ç–∏—á–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ
2. **–ò–∑–æ–ª—è—Ü–∏—è —Ç–µ—Å—Ç–æ–≤** - ‚úÖ –ö–∞–∂–¥—ã–π —Ç–µ—Å—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º
3. **–ë—ã—Å—Ç—Ä—ã–µ unit —Ç–µ—Å—Ç—ã** - ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ
4. **–ú–µ–¥–ª–µ–Ω–Ω—ã–µ integration —Ç–µ—Å—Ç—ã** - –ø–æ–º–µ—á–µ–Ω—ã –æ—Ç–¥–µ–ª—å–Ω–æ

---

## üìä –ú–ï–¢–†–ò–ö–ò –ü–û–ö–†–´–¢–ò–Ø

### –¢–µ–∫—É—â–µ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ (–ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–µ—Å—Ç–æ–≤):

| –ú–æ–¥—É–ª—å | –ü–æ–∫—Ä—ã—Ç–∏–µ | –°—Ç–∞—Ç—É—Å |
|--------|----------|--------|
| utils/cache.py | ~95% | ‚úÖ –û—Ç–ª–∏—á–Ω–æ |
| utils/helpers.py | ~100% | ‚úÖ –û—Ç–ª–∏—á–Ω–æ |
| config.py | ~80% | ‚úÖ –•–æ—Ä–æ—à–æ |
| services/car_service.py | ~90% | ‚úÖ –û—Ç–ª–∏—á–Ω–æ |
| database/db_pool.py | ~70% | ‚ö†Ô∏è –°—Ä–µ–¥–Ω–µ |
| database/repositories/car_repository.py | ~85% | ‚úÖ –•–æ—Ä–æ—à–æ |
| handlers/* | 0% | ‚ùå –ö—Ä–∏—Ç–∏—á–Ω–æ |
| utils/scheduler.py | 0% | ‚ùå –ö—Ä–∏—Ç–∏—á–Ω–æ |
| utils/notifications.py | 0% | ‚ùå –ö—Ä–∏—Ç–∏—á–Ω–æ |

**–û–±—â–µ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ:** ~40-50% (–ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –±–∞–∑–æ–≤—ã—Ö —Ç–µ—Å—Ç–æ–≤)

**–¶–µ–ª–µ–≤–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ:** >80%

---

## üöÄ –ü–õ–ê–ù –î–ï–ô–°–¢–í–ò–ô

### –§–∞–∑–∞ 1: –ë–∞–∑–æ–≤—ã–µ —Ç–µ—Å—Ç—ã (‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ)
- ‚úÖ –¢–µ—Å—Ç—ã –¥–ª—è cache
- ‚úÖ –¢–µ—Å—Ç—ã –¥–ª—è helpers
- ‚úÖ –¢–µ—Å—Ç—ã –¥–ª—è config
- ‚úÖ –¢–µ—Å—Ç—ã –¥–ª—è car_service
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è –ë–î

### –§–∞–∑–∞ 2: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥)
- [ ] –¢–µ—Å—Ç—ã –¥–ª—è handlers (user, admin)
- [ ] –¢–µ—Å—Ç—ã –¥–ª—è scheduler
- [ ] –¢–µ—Å—Ç—ã –¥–ª—è notifications
- [ ] –¢–µ—Å—Ç—ã –¥–ª—è rental_repository
- [ ] –¢–µ—Å—Ç—ã –¥–ª—è user_repository

### –§–∞–∑–∞ 3: –†–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ
- [ ] E2E —Ç–µ—Å—Ç—ã
- [ ] –¢–µ—Å—Ç—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- [ ] –¢–µ—Å—Ç—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- [ ] –¢–µ—Å—Ç—ã –¥–ª—è keyboards

---

## üìù –ö–û–ú–ê–ù–î–´ –î–õ–Ø –ó–ê–ü–£–°–ö–ê –¢–ï–°–¢–û–í

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
pip install -r requirements-dev.txt

# –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤
pytest

# –ó–∞–ø—É—Å–∫ —Ç–æ–ª—å–∫–æ unit —Ç–µ—Å—Ç–æ–≤
pytest tests/unit/

# –ó–∞–ø—É—Å–∫ —Ç–æ–ª—å–∫–æ integration —Ç–µ—Å—Ç–æ–≤
pytest tests/integration/

# –ó–∞–ø—É—Å–∫ —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º
pytest --cov=bot --cov-report=html

# –ó–∞–ø—É—Å–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞
pytest tests/unit/test_cache.py::TestSimpleCache::test_set_and_get

# –ó–∞–ø—É—Å–∫ –≤ verbose —Ä–µ–∂–∏–º–µ
pytest -v

# –ó–∞–ø—É—Å–∫ —Å –≤—ã–≤–æ–¥–æ–º print statements
pytest -s
```

---

**–î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞:** 2024  
**–í–µ—Ä—Å–∏—è:** 1.0






