<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–∞—Ç–∞–ª–æ–≥ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π - OLIMP AUTO</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--tg-theme-bg-color, #1c1c1e);
            color: var(--tg-theme-text-color, #ffffff);
            padding: 10px;
            min-height: 100vh;
        }

        h2 {
            text-align: center;
            margin-bottom: 20px;
            font-weight: 700;
            font-size: 24px;
            color: var(--tg-theme-text-color, #ffffff);
        }

        .container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 20px;
        }

        .card {
            background: var(--tg-theme-secondary-bg-color, #2c2c2e);
            border-radius: 12px;
            padding: 10px;
            text-align: center;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            cursor: pointer;
        }

        .card:active {
            transform: scale(0.98);
        }

        .card img {
            width: 100%;
            border-radius: 8px;
            height: 90px;
            object-fit: cover;
            margin-bottom: 8px;
            background: var(--tg-theme-bg-color, #1c1c1e);
        }

        .title {
            font-weight: bold;
            margin: 5px 0;
            font-size: 14px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            color: var(--tg-theme-text-color, #ffffff);
        }

        .price {
            color: var(--tg-theme-link-color, #007aff);
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .status {
            font-size: 11px;
            padding: 2px 6px;
            border-radius: 4px;
            display: inline-block;
            margin-bottom: 8px;
        }

        .status.available {
            background-color: rgba(52, 199, 89, 0.2);
            color: #34c759;
        }

        .status.unavailable {
            background-color: rgba(255, 59, 48, 0.2);
            color: #ff3b30;
        }

        .btn {
            background-color: var(--tg-theme-button-color, #007aff);
            color: var(--tg-theme-button-text-color, #ffffff);
            border: none;
            padding: 8px 0;
            border-radius: 8px;
            width: 100%;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: opacity 0.2s;
        }

        .btn:active {
            opacity: 0.7;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: var(--tg-theme-hint-color, #8e8e93);
        }

        .error {
            text-align: center;
            padding: 20px;
            color: #ff3b30;
        }

        @media (max-width: 480px) {
            .container {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <h2>üöó –í—ã–±–µ—Ä–∏—Ç–µ –∞–≤—Ç–æ–º–æ–±–∏–ª—å</h2>
    <div class="container" id="car-list">
        <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ç–∞–ª–æ–≥–∞...</div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
        tg.ready();
        tg.expand(); // –†–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ–º –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω
        
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ MainButton (–±–æ–ª—å—à–∞—è –∫–Ω–æ–ø–∫–∞ –≤–Ω–∏–∑—É –≤ Telegram)
        tg.MainButton.textColor = "#FFFFFF";
        tg.MainButton.color = "#2cab37";
        tg.MainButton.hide();

        const container = document.getElementById('car-list');
        let selectedCar = null;

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ –±–æ—Ç–∞
        // –í —Ä–µ–∞–ª—å–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å API endpoint –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
        async function loadCars() {
            try {
                // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ initData (–µ—Å–ª–∏ –ø–µ—Ä–µ–¥–∞–Ω—ã –±–æ—Ç–æ–º)
                // –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º mock –¥–∞–Ω–Ω—ã–µ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
                const initData = tg.initData;
                
                // –í —Ä–µ–∞–ª—å–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –∑–∞–ø—Ä–æ—Å –∫ API –±–æ—Ç–∞
                // –ü–æ–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º mock –¥–∞–Ω–Ω—ã–µ
                const cars = await fetchCarsFromBot();
                
                if (cars && cars.length > 0) {
                    renderCars(cars);
                } else {
                    container.innerHTML = '<div class="error">‚ùå –ö–∞—Ç–∞–ª–æ–≥ –ø—É—Å—Ç</div>';
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π:', error);
                container.innerHTML = '<div class="error">‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ç–∞–ª–æ–≥–∞</div>';
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π (–∑–∞–≥–ª—É—à–∫–∞ - –≤ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ –±—É–¥–µ—Ç API –∑–∞–ø—Ä–æ—Å)
        async function fetchCarsFromBot() {
            // Mock –¥–∞–Ω–Ω—ã–µ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
            // –í —Ä–µ–∞–ª—å–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –∑–∞–ø—Ä–æ—Å –∫ API –±–æ—Ç–∞
            return [
                {id: 1, name: "Hyundai Solaris", price: 2500, img: "https://via.placeholder.com/150/0000FF/808080?text=Solaris", available: true},
                {id: 2, name: "Kia K5 Business", price: 4500, img: "https://via.placeholder.com/150/FF0000/FFFFFF?text=Kia+K5", available: true},
                {id: 3, name: "BMW 5 Series", price: 8000, img: "https://via.placeholder.com/150/000000/FFFFFF?text=BMW+5", available: true},
                {id: 4, name: "Mercedes E-Class", price: 9500, img: "https://via.placeholder.com/150/FFFF00/000000?text=Mercedes", available: false},
                {id: 5, name: "Geely Monjaro", price: 7000, img: "https://via.placeholder.com/150/008000/FFFFFF?text=Geely", available: true}
            ];
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π
        function renderCars(cars) {
            container.innerHTML = '';
            
            cars.forEach(car => {
                const card = document.createElement('div');
                card.className = 'card';
                
                const imageUrl = car.image_1 || car.img || 'https://via.placeholder.com/150/CCCCCC/666666?text=–ù–µ—Ç+—Ñ–æ—Ç–æ';
                const priceText = `${car.daily_price ? car.daily_price.toLocaleString('ru-RU') : car.price} ‚ÇΩ/—Å—É—Ç.`;
                const isAvailable = car.available !== false;
                
                card.innerHTML = `
                    <img src="${imageUrl}" alt="${car.name}" onerror="this.src='https://via.placeholder.com/150/CCCCCC/666666?text=–ù–µ—Ç+—Ñ–æ—Ç–æ'">
                    <div class="title">${car.name}</div>
                    <div class="price">${priceText}</div>
                    <div class="status ${isAvailable ? 'available' : 'unavailable'}">
                        ${isAvailable ? '‚úÖ –î–æ—Å—Ç—É–ø–µ–Ω' : '‚ùå –ù–µ–¥–æ—Å—Ç—É–ø–µ–Ω'}
                    </div>
                    <button class="btn" onclick="selectCar(${car.id}, '${car.name.replace(/'/g, "\\'")}', ${isAvailable})" ${!isAvailable ? 'disabled' : ''}>
                        ${isAvailable ? '–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å' : '–ù–µ–¥–æ—Å—Ç—É–ø–µ–Ω'}
                    </button>
                `;
                
                container.appendChild(card);
            });
        }

        // –§—É–Ω–∫—Ü–∏—è –≤—ã–±–æ—Ä–∞ –∞–≤—Ç–æ–º–æ–±–∏–ª—è
        function selectCar(id, name, isAvailable) {
            if (!isAvailable) {
                // –¢–∞–∫—Ç–∏–ª—å–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å
                if (tg.HapticFeedback) {
                    tg.HapticFeedback.notificationOccurred('error');
                }
                return;
            }

            // –¢–∞–∫—Ç–∏–ª—å–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å
            if (tg.HapticFeedback) {
                tg.HapticFeedback.impactOccurred('medium');
            }

            selectedCar = { id, name };
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –æ–±—Ä–∞—Ç–Ω–æ –≤ –±–æ—Ç–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON
            const data = JSON.stringify({
                action: "book_car",
                car_id: id,
                car_name: name
            });
            
            tg.sendData(data);
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
            tg.showAlert('–ó–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞! –ú–µ–Ω–µ–¥–∂–µ—Ä —Å–≤—è–∂–µ—Ç—Å—è —Å –≤–∞–º–∏ –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è.');
        }

        // –ó–∞–≥—Ä—É–∂–∞–µ–º –∞–≤—Ç–æ–º–æ–±–∏–ª–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        loadCars();
    </script>
</body>
</html>

